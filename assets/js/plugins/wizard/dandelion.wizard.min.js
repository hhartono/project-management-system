/*
 * Dandelion Admin v2.0 - Wizard Form JS
 *
 * This file is part of Dandelion Admin, an Admin template build for sale at ThemeForest.
 * For questions, suggestions or support request, please mail me at maimairel@yahoo.com
 *
 * Development Started:
 * March 25, 2012
 * Last Update:
 * December 07, 2012
 *
 * 'Highly configurable' mutable plugin boilerplate
 * Author: @markdalgleish
 * Further changes, comments: @addyosmani
 * Licensed under the MIT license
 *
 */

;(function(c,m,n,g){var h=function(a,b){arguments.length&&this._init(a,b)};h.prototype={defaults:{element:"fieldset",labelElement:"legend",buttonContainerClass:"btn-row",nextButtonClass:"btn btn-danger pull-left",prevButtonClass:"btn pull-left",submitButtonClass:"btn btn-primary",activeIconClass:"icol-accept",nextButtonLabel:"Next",prevButtonLabel:"Prev",submitButtonLabel:"Submit",submitButtonName:"dnd-wizard",forwardOnly:!1,onLeaveStep:null,onShowStep:null,onBeforeSubmit:null,ajaxSubmit:!1,ajaxFormOptions:{}},
_init:function(a,b){this.element=c(a);this.options=c.extend({},this.defaults,b,this.element.data());this._activeWzdId=-1;this._navigationLocked=!1;this._activatedSteps=[];this._parseOptions();this.steps=this.element.find(this.options.element);this.steps.hide();this.nav=this._buildNavigation(this.steps);this.buttons=this._buildButtons();this.element.before(c('<div class="dwizard-nav"></div>').append(this.nav));this.element.append(c('<div class="btn-row"></div>').append(c.map(this.buttons,function(a){return a})));
this._bindEventHandlers();this._navigate(this.steps.eq(0).data("wzd-id"),!0)},_callFunction:function(a,b){return!c.isFunction(a)?!0:a.apply(this,b)},_parseOptions:function(){if(this.options.ajaxSubmit&&c.fn.ajaxSubmit){var a=this.options.ajaxFormOptions.success,b=this.options.ajaxFormOptions.complete,d=this.options.ajaxFormOptions.error,e=this.options.ajaxFormOptions.beforeSend,i=this.options.ajaxFormOptions.beforeSubmit,f=this.options.ajaxFormOptions.beforeSerialize;this.options.ajaxFormOptions=
c.extend({},this.options.ajaxFormOptions,{success:function(b,d,e,i){c.isFunction(a)&&a.call(this,b,d,e,i)},complete:function(a,d){c.isFunction(b)&&b.call(this,a,d)},error:function(a,b){c.isFunction(d)&&d.call(this,a,b)},beforeSubmit:function(a,b,d){return c.isFunction(i)?i.call(this,arr,b,d):!0},beforeSend:function(a){return c.isFunction(e)?e.call(this,a):!0},beforeSerialize:function(a,b){return c.isFunction(f)?f.call(this,a,b):!0}});this.element.ajaxForm(this.options.ajaxFormOptions)}},_generateRandomId:function(){var a=
(new Date).getTime().toString(32),b;for(b=0;3>b;b++)a+=Math.floor(65535*Math.random()).toString(32);return"wzd_"+a},_retrieveIcons:function(a,b){var d=b.data(),e=c('<i class="wzd-icon"></i>');return[d.icon!==g?e.addClass(d.icon):e.html(++a),c('<i class="wzd-active-icon"></i>').addClass(this.options.activeIconClass)]},_buildNavigation:function(a){var b=this,d=c("<ul></ul>"),e=a.length;c.each(a,function(a,f){var g=c("<li></li>"),j=c(f).find(b.options.labelElement).hide(),h=c('<span class="wzd-link"></span>'),
k=c('<span class="wzd-label"></span>').text(j.text()),j=b._retrieveIcons(a,j),l=100/e+"%";g.append(h.append(j)).append(k).appendTo(d);g.css({width:l});c(f).add(g).attr("data-wzd-id",b._generateRandomId())});return c(d.append(c("<li></li>").addClass("progress")))},_buildButtons:function(){var a=c('<button type="button"></button>'),b=a.clone().addClass(this.options.prevButtonClass).text(this.options.prevButtonLabel),d=a.clone().addClass(this.options.nextButtonClass).text(this.options.nextButtonLabel),
a=a.clone().addClass(this.options.submitButtonClass).text(this.options.submitButtonLabel).attr("name",this.options.submitButtonName);return{prev:b,next:d,submit:a}},_refreshButtons:function(){this.buttons.prev.attr("disabled",this._isFirstStep(this._activeWzdId));this.buttons.next.attr("disabled",this._isLastStep(this._activeWzdId));this.buttons.submit.toggle(this._isLastStep(this._activeWzdId))},_bindEventHandlers:function(){var a=this;this.nav.on("click",".wzd-link",function(b){a._navigate(c(this).parents("li").data("wzd-id"));
b.preventDefault()});this.buttons.prev.on("click",function(b){a.prev();b.preventDefault()});this.buttons.next.on("click",function(b){a.next();b.preventDefault()});this.buttons.submit.on("click",function(b){a.submitForm();b.preventDefault()})},_canNavigate:function(a){var a=this._findStep(a),b=this._findStep(this._activeWzdId);return!this._navigationLocked&&!(this.options.forwardOnly&&a&&b&&a.index()<=b.index())},_stepActivated:function(a){return this._validWzdId(a)&&-1<c.inArray(a,this._activatedSteps)},
_activateStep:function(a){if(this._validWzdId(a)){for(var b=this._findNav(a).index(),d=0;d<b;++d)if(-1===c.inArray(this.steps.eq(d).data("wzd-id"),this._activatedSteps))return;-1===c.inArray(a,this._activatedSteps)&&this._activatedSteps.push(a)}},_setActiveIcon:function(a){this._validWzdId(a)&&this._findNav(a).addClass("wzd-done")},_findStep:function(a){return this.steps.filter('[data-wzd-id="'+a+'"]').first()},_findNav:function(a){return this.nav.children("li").filter('[data-wzd-id="'+a+'"]').first()},
_navigate:function(a,b){if(this._validWzdId(a)&&(b||this._canNavigate(a)&&this._callFunction(this.options.onLeaveStep,[this,this._findStep(this._activeWzdId)[0]])))this._activateStep(a),this._showStep(a)},_showStep:function(a){if(this._validWzdId(a))if(-1===this._activeWzdId)this.steps.hide(),this._findStep(a).show(),this._updateNav(a),this._activeWzdId=a,this._refreshButtons();else if(a!==this._activeWzdId&&this._stepActivated(a)){var b=this._findStep(this._activeWzdId),c=this;c._setActiveIcon(c._activeWzdId);
this._navigationLocked=!0;b.fadeOut("fast",function(){c._updateNav(a);var b=c._findStep(a);b.fadeIn("fast",function(){c._activeWzdId=a;c._navigationLocked=!1;c._refreshButtons();c._callFunction(c.options.onShowStep,[c,b])})})}},_updateNav:function(a){if(this._validWzdId(a)){var b=this._findNav(a).index(),a=this.nav.children().filter(".progress"),b=(100/this.nav.children().filter(":not(.progress)").length*++b).toString()+"%";a.css({width:b})}},_isLastStep:function(a){return this._validWzdId(a)&&a===
this.steps.last().data("wzd-id")},_isFirstStep:function(a){return this._validWzdId(a)&&a===this.steps.first().data("wzd-id")},_validWzdId:function(a){return"string"===typeof a&&0===a.indexOf("wzd_")},next:function(){this._isLastStep(this._activeWzdId)||this._navigate(this._findStep(this._activeWzdId).next().data("wzd-id"))},prev:function(){this._isFirstStep(this._activeWzdId)||this._navigate(this._findStep(this._activeWzdId).prev().data("wzd-id"))},submitForm:function(){this._callFunction(this.options.onBeforeSubmit,
[this,this.element])&&this.element.submit()},reset:function(){this._activatedSteps=[];this._activeWzdId=-1;this._navigationLocked=!1;this.steps.hide();c.fn.clearForm&&this.element.clearForm();this.nav.children("li").removeClass("wzd-done");this._navigate(this.steps.eq(0).data("wzd-id"),!0)},option:function(a,b){if(0===arguments.length)return c.extend({},this.options);if("string"===typeof a){if(b===g)return this.options[a];this.options[a]=b}return this}};c.fn.wizard=function(a){var b="string"===typeof a,
d=Array.prototype.slice.call(arguments,1),e=this;if(b&&"_"===a.charAt(0))return e;b?this.each(function(){var b=c.data(this,"wizard"),f=b&&c.isFunction(b[a])?b[a].apply(b,d):b;if(f!==b&&f!==g)return e=f,!1}):this.each(function(){c.data(this,"wizard")||c.data(this,"wizard",new h(this,a))});return e}})(jQuery,window,document);